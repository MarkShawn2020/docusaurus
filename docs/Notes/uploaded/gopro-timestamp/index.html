<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Notes/uploaded/gopro-timestamp">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/keeps-learning/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/keeps-learning/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">GoPro终极开发指南 | 从添加时间戳说起 | 南川笔记</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/keeps-learning/docs/Notes/uploaded/gopro-timestamp"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GoPro终极开发指南 | 从添加时间戳说起 | 南川笔记"><meta data-rh="true" name="description" content="1. 方案1：物理手段解决"><meta data-rh="true" property="og:description" content="1. 方案1：物理手段解决"><link data-rh="true" rel="icon" href="/keeps-learning/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/keeps-learning/docs/Notes/uploaded/gopro-timestamp"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/keeps-learning/docs/Notes/uploaded/gopro-timestamp" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/keeps-learning/docs/Notes/uploaded/gopro-timestamp" hreflang="x-default"><link rel="stylesheet" href="/keeps-learning/assets/css/styles.6bbfa55a.css">
<link rel="preload" href="/keeps-learning/assets/js/runtime~main.3430d87e.js" as="script">
<link rel="preload" href="/keeps-learning/assets/js/main.7d0120fb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/keeps-learning/"><div class="navbar__logo"><img src="/keeps-learning/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/keeps-learning/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">南川笔记</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/keeps-learning/docs/">My Docs</a><a class="navbar__item navbar__link" href="/keeps-learning/blog">My Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/keeps-learning" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keeps-learning/docs/">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keeps-learning/docs/TODO">TODO</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/keeps-learning/docs/SLAM/A01-recognizeLights">SLAM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/A01-recognizeLights">A01: recognize lights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/slam-research">slam-research</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/slambook2-ch13">slambook2-ch13</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/slambook2-learning">slambook2-learning</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/AndroidFramework/AOSP/TaskA1-aosp-pull/aosp-pull">AndroidFramework</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/Coding/CPP/cpp-howto">Coding</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/keeps-learning/docs/Notes/uploaded/I-am-me">Notes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/I-am-me">uploaded</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/I-am-me">我与我周旋久，我亦是我</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/DataAnalysis-Gaokao">数据分析案例分享 | 使用pandas研究高考志愿填报</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/auto-voice2srt">南川应用研究 | 视频剪辑自动转写字幕</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/douban_rent-houses/mark_rent-house-research">douban_rent-houses</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/gopro-timestamp">GoPro终极开发指南 | 从添加时间戳说起</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/ios-automation">深度技术分享 | iOS自动化实现王者荣耀一键换装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/life-is-not-easy">南川流思录 | 须知，活好是很不容易的</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_12h-struggle-with-webpack">南川开发笔记 | 记与Webpack十二小时的奋战</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_2022-live/mark_2022-live_1">mark_2022-live</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_2022-live">2022，活着</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_beike-hr">贝壳新业务VR全职开发招募</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_core-notes-of-linux">南川2022核心开发笔记 | Linux指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_eidt-mp3-meta">南川技术分享 | 逼哥的音乐元数据修复</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_happy-new-year-of-2022">2022·关于近几年的一些感悟</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_im-working-now">是的，我入职了</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_massage_breo-dream6">南川评测 | Breo Dream6按摩仪</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_my2021">我的2021：混沌与洞见</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_our-lives">愿逝者安息生者坚强，你我迎风奔跑向阳而生</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mark_self-cultivation_of_engineer">一位工程师的自我修养（序）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/mbti/mark_mbti">mbti</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/Notes/uploaded/my-gopro">我们找到了一种纯视频记录人生的解决方案：基于GoPro的全天候自动4K延时摄影</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/OS/Linux/centos-init-manual">OS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/Softwares/Adobe/PS/support-for-little-stars/">Softwares</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keeps-learning/docs/TODO-closed">TODO-closed</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/keeps-learning/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Notes</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">uploaded</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">GoPro终极开发指南 | 从添加时间戳说起</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.16.0+</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>GoPro终极开发指南 | 从添加时间戳说起</h1><ol><li>方案1：物理手段解决</li><li>方案2：借助<strong>OpenCV</strong>基于文件创建时间进行推算</li><li>方案3：借助<strong>GoPro Labs</strong>添加时间戳浮层<ol><li>浮层大小</li><li>浮层内容</li><li>浮层位置</li><li>二维码生成</li><li>二维码使用</li><li>缺陷</li><li>其他用处</li></ol></li><li>*方案3个人笔记<ol><li>LAB01: how to install the labs firmware</li><li>LAB02: QR Controls For Settings</li><li>LAB03: add an overlay to viedeo</li></ol></li><li>最后一点感受</li></ol><p>在上一期【文章：gopro】中，我们提供了一种借助gopro基于延时摄影从而底层本高质量地全程记录个人生活的解决方案，实测中这个方案仍然有一些不足之处，本期就重点探讨时间戳相关的问题。</p><p>这个问题其实很关键，因为我们正在做的事情是长时间无感拍摄，目的是为了后期复盘，但在复盘过程中，由于延时时间跨度过长，我们希望知道视频里的每一帧所拍摄的实际时间，比如是某月某日的下午两点还是夜间十点，这是一个很自然的需求。</p><p>但很可惜，这个问题并不容易解决。</p><p>以下便基于这个问题，提供实际可行的三种方案。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="方案1物理手段解决">方案1：物理手段解决<a class="hash-link" href="#方案1物理手段解决" title="标题的直接链接">​</a></h2><p>如果你是一个比较传统的、具有较强时间观的人，也许这种方案特别适合你，那就是直接选购一款挂钟（这也是我在上篇文章中所采用的方法）。</p><p>例如，我们这里有一段使用挂钟时期的成品视频：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655354709985-843159c3c155958989a9d5791053dbaecaca765cf48c91ebed9afd66f5c1d33a.png" alt="picture 3" class="img_ev3q">  </p><p>将我们的挂钟摆在所拍摄视频中的合理位置，既增强了画面构图感，也能实时知道每一帧所对应的真实时间，这确实有一石二鸟之效。</p><p>但很可惜，这种方案，并未能坚持多久，原因是，廉价的挂钟机芯转动声音影响到了自己的睡眠。</p><p>按照我对睡眠无声的要求，在依次关闭空调、窗户、电脑散热器、硬盘柜之后，室内的声音强度耳测应该已经低于30分贝，此时挂钟的声音就显得尤为明显了。</p><p>尽管它不大，但确实也没那么动听，至少甚至不如星际穿越的曲子《Tick-Tock》的前奏。</p><p>除非我愿意花更多的时间与金钱去筛选到另一款真正无声的挂钟，但作为一名程序猿，也许有更廉价与炫酷的方案。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="方案2借助opencv基于文件创建时间进行推算">方案2：借助<strong>OpenCV</strong>基于文件创建时间进行推算<a class="hash-link" href="#方案2借助opencv基于文件创建时间进行推算" title="标题的直接链接">​</a></h2><blockquote><p>本节参考：- <a href="https://www.theeminentcodfish.com/gopro-timestamp/" target="_blank" rel="noopener noreferrer">GoPro TimeStamp - The Eminent Codfish</a></p></blockquote><p>事实上，由于我们的延时摄影采用了固定时间间隔的方案（有关“自动时间间隔”与“固定时间间隔”方案的差异与优劣，也在上篇文章中有阐述），因此只要我们知道视频的任何一帧所对应的真实物理时间，我们就可以基于等差数列算法进行推算。</p><p>而这，恰恰可行，因为gopro的视频输出格式为mp4，里面保存了文件的创建时间。</p><p>不过，这个文件创建时间，可不是我们在电脑上看到的那个文件创建时间，这不是同一个概念。</p><p>例如，我们这里有一段视频的开头显示是6月15日10点05分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355366257-b01f6386d8aaa7fc57ca802956a6fd73fc4f6628385437e0055b8bd94622b6f9.png" alt="picture 4" class="img_ev3q">  </p><p>但在我们的文件管理器上查看该文件的创建时间却是6月16日10点57分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355421774-dc43ac335c5f11ebcbda9c81edde670f3e7f285321771c5f1a0ad443f8f22e2a.png" alt="picture 5" class="img_ev3q">  </p><p>这显然不是时区的问题，而是操作系统问题，即在操作系统里定义的文件创建时间是该文件在本地磁盘上首次产生的时间，而非文件本身的首次创建时间（对于该视频来说，尤指该视频开始拍摄的时间）。</p><p>但我们并非没有手段获取实际视频创建时间，答案就是基于软件解析的手段：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655356074973-cf5d985ee99cf99c2e87527c0ea19e095d2c433ceb7bed96d27be097804bb0ba.png" alt="picture 6" class="img_ev3q">  </p><p>上述代码使用了<code>ffprobe</code>这个指令解析了我们的mp4文件，从结果中的<code>creation_time</code>标签得到了我们想要的视频创建的真实时间，于是乎，最难的问题解决了。</p><p>接下来，我们就基于视频领域的一些基本概念为我们的视频加上时间戳信息。</p><p>第一步是关于帧的。</p><p>在之前文章中我们说我们的视频是每5秒延时拍摄一帧，也就是每过一帧实际时间就要<strong>大致</strong>加五秒，这是一个很重要的信息。</p><p>而整个流程就是使用opencv读取我们视频的每一帧，然后算出该帧的时间，然后将格式化的时间戳放到那一帧上面去，最后再输出成一个新的视频，这个过程就叫“烧录”。</p><p>核心代码如下：</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ref: - [GoPro TimeStamp - The Eminent Codfish](https://www.theeminentcodfish.com/gopro-timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> subprocess </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tqdm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tqdm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> get_file_creation_time </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FONT_COLOR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># blue, green, red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;_with-timestamp&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Opens the video import and sets parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VideoCapture</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isOpened</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;failed to open video of </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">file_path</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FPS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_WIDTH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_HEIGHT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    frames_cnt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_COUNT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># float -&gt; int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> frames_cnt </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Initializes time origin of the video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_creation_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur_frame_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datetime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;frames_cnt: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, FPS: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">FPS</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, initial_timestamp: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cur_frame_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, dimension: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> x </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, duration: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Command to send via the command prompt which specifies the pipe parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ffmpeg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-y&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># (optional) overwrite output file if it exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-f&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rawvideo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Input is raw video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-vcodec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rawvideo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-pix_fmt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bgr24&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Raw video format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-s&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;x&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># size of one frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-r&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># frames per second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-i&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The input comes from a pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-an&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Tells FFMPEG not to expect any audio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-vcodec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mpeg4&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-b:v&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10M&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sets a maximum bit rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># output file path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Open the pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Popen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stdin</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;====== OpenCV is processing =======&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_time_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Reads through each frame, calculates the cur_frame_time, places it on the frame and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># exports the frame to the output video.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> tqdm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frames_cnt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;ERROR: failed to read frame of [</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cur_frame_time </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seconds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Date: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Time: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> image </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;====== finished =======&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_used_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> process_time_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;used time: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, video period: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, multiplier: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time </span><span class="token string-interpolation interpolation operator" style="color:#393A34">/</span><span class="token string-interpolation interpolation"> duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stderr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/Volumes/Disk1/videos/gopro日常/gopro延时生活/2022-06-14/GH011701.MP4&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358120832-aa46758f93ddc61e960a10c274e8fb7ea49276b152f7d3fa6e343d02c1e2bc9a.png" alt="picture 7" class="img_ev3q">  </p><p>可以看到，基本一比一的处理速度，也就是说原视频时间有多长，程序运行时间就有多长，对于延时摄影来说，一天的录制输出大概就是十分钟的视频，因此脚本每天的运行时长也就是在十分钟左右，这是可以接受的。</p><p>不过这个脚本也有一点点小问题。</p><p>第一个问题是每次读取到第二十帧的时候就会报错，之后就没问题，不明白什么原因，也似乎不影响程序的表现，这个属于opencv范畴的问题了，留到以后再考虑了。</p><p>第二个问题就是输出的视频文件比原文件要小很多，直接差了十倍……：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358301337-0a3bc21ac1b530ed8f43053e33a9dc99fc89d90bd464a0e3335c942c9c01ab41.png" alt="picture 8" class="img_ev3q">  </p><p>我们放在一起比对了一下，发现分辨率是没区别的，区别可能是在编码上：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358410672-57cab49192da7b59eed7ba618c39d6d255cee16c69296294643a68eff01f401d.png" alt="picture 9" class="img_ev3q">  </p><p>实际看了一下，发现确实画质上有较大区别，比如原视频的白墙很光滑：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358467434-475e70206879f5478766392201a3660654973eec188934dfe157dbd2a24e0bb0.png" alt="picture 10" class="img_ev3q">  </p><p>但编码后的白墙就明显有那种类似波纹的效果了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358486566-93f149d18618d08ed0741e37dce78415d64e105c79d847a015f57ce19da5d9f1.png" alt="picture 11" class="img_ev3q">  </p><p>从这个角度上说，如果不考虑修改脚本，使之输出原质量的视频，那么我们的脚本输出的视频就只能当做备份与参照视频了，毕竟十倍的比率确实也有一些用武之地。</p><p>然而，这个脚本实际上还有另一个问题，那就是时间不一定能对齐。</p><p>比如刚刚文件对比图上，一个是20秒，一个是19秒，当然这个其实没有太大所谓了（虽然很非遗所以，也许就是和上面那个有两帧无法处理的问题有关），我更关心的是另一个对齐问题，曝光与时间间隔。</p><p>就是，怎么说呢，我现在并不确定gopro的曝光与拍摄间隔之间的关系，比如说，假设我们设置拍摄间隔为2秒，曝光时长为1秒，那么它是每3秒拍一次照片还是每2秒拍一张呢？</p><p>如果是每3秒拍一次照片，那么我们的算法每一帧加5秒就有问题，因为没有算上曝光时间，这样就会导致累积时间变少。</p><p>但如果是每2秒拍一张照片，那么更极端的一个情况，例如拍摄间隔为1秒，曝光时长为2秒，则似乎就无法拍摄了……</p><p>所以，这里有研究一下的必要。</p><p>总之，这种借助opencv进行后期处理的手段还是有一定实用价值，适用于很多其他的领域，是一种通用技术手段，我们有必要掌握，并且我对熟练掌握opencv之后输出我们想要的视频结果的可能性抱有很高的期望，除了曝光与拍摄间隔对齐的问题之外。</p><p>但输出的画面质量不佳（若提高质量（假设可行），势必速度会下降）与额外脚本运行的不便等因素，使我最后选择了第三种更干净的方案：<code>GoPro Labs</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="方案3借助gopro-labs添加时间戳浮层">方案3：借助<strong>GoPro Labs</strong>添加时间戳浮层<a class="hash-link" href="#方案3借助gopro-labs添加时间戳浮层" title="标题的直接链接">​</a></h2><p>如果说第二种方案属于后期，那么本方案则属于前期了。</p><p>众所周知，防患于未然，能从前期着手的方案，基本都是最优的。</p><p>而GoPro Labs就能帮助我们实现这点。</p><p>我们要做的事情就是：</p><ol><li>下载GoPro Labs的固件版本，完成固件升级（我的GoPro是9，是支持的）</li><li>制作我们的时间戳浮层二维码，扫描后使用</li></ol><p>主要通过这个网站： <a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a> 生成我们所需的二维码，这里的每个参数都比较重要，我们一一解释：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="浮层大小">浮层大小<a class="hash-link" href="#浮层大小" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359589767-225e990742d950f8587e2c402e3368a9e244f5412a936ac5d47065be0bfe3eea.png" alt="picture 12" class="img_ev3q">  </p><p><code>vertical size</code>是浮层的整体高度，而非单个文字的高度，由于浮层支持多行文本，因此为了目标字体大小，多行文本时对应的竖直高度也要变高，我们设置为60，对应三行文本，（也就是每行20，单位大概是像素），效果不错</p><p><code>horizontal size</code>是浮层的整体宽度，因为这个底层是按行排版文本，因此我们直接设置成0，让它自动调整浮层的宽度即可，即所有行中最长的行的宽度</p><p><code>offset from the edge</code>是与画面边缘（应该是Y轴，因为X轴距离可以通过下文的换行符控制）的距离， 目前使用的是10，效果还不错</p><p><code>Limit dispaly time</code>设置成unlimited即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="浮层内容">浮层内容<a class="hash-link" href="#浮层内容" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359884415-4a3b036583d6c3be88ca734bf9e9e51f76a3f6600c7ca7d3a5fd2751f4609384.png" alt="picture 13" class="img_ev3q">  </p><p>这个就是配置我们的自定义文本与时间、日期的地方，它是一行行下来的，可以自己用<code>\n</code>分隔符换行（但不可以换顺序，所以时间始终在日期之前）。</p><p>为了从简，我没有加任何个人自定义短语（一开始加了自己的昵称，后来觉得太冗余了，所以还是留空了），但我在尾部加了两个空行，这是为了主动地增加相机与底部（X轴）的边距，这样输出的视频里的时间戳在我mac电脑上预览时不会被进度条挡住。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="浮层位置">浮层位置<a class="hash-link" href="#浮层位置" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360216872-e9f80b49b95e94ae25f967b4693cdd17aef45684d829b5e2986a0b246b40e314.png" alt="picture 16" class="img_ev3q">  </p><p>我将时间戳放在了左下角，因为我平常会在右下角办公，而画面中上部则是主体区域。</p><p>我们的场景中不需要使用GPS。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="二维码生成">二维码生成<a class="hash-link" href="#二维码生成" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360265681-720de6db987621a49e2a200321fcffca430ef8a599e20145dd6d7804e5b3aba5.png" alt="picture 17" class="img_ev3q">  </p><p>在生成二维码附近还有是否选择<code>active</code>的选项，我之前一开始捣鼓lab时弄出了bug，在 模式设置：<a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a> 中设置出了一个没有的模式，导致系统死掉，最后刷回GoPro9 1.5的稳定固件版本，然后重新升级到lib版本才恢复，这其中既有可能是模式问题，也有可能是这个浮层当时选了<code>permanent</code>选项，因此我现在已经完全不敢点这个选项了。但并不影响我目标功能的实现。</p><p>基于这些，最终的二维码就生成了，它对应的QR Command是：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN=&quot;(0,60)[BLHH:MM:SSaa mm-dd-yyyy]\n&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以后我直接基于这个Command字符串进行修改即可，还是很方便的，比如加上自定义前缀与后缀的结果如下：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN=&quot;(0,60)哈哈哈[BLHH:MM:SSaa mm-dd-yyyy]略略略\n&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我们用函数去表达这个字符串输出就是：</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_gopro_overlay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_edge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_leading</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_ending</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime_format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;g0oMBRNO=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_edge</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">oMBURN=&quot;(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_leading</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">[BL</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime_fornat</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_ending</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意到，我们的时间格式也是可以自定义的，并且如果我们基于从字符串（而非网页交互）出发去生成二维码，那么我们就可以定义日期在前时间在后的格式了，比如<code>yyyyy-mm-dd HH:MM:SSaa</code>。虽然这一点未经过测试，但想必是可行的（写文章时才意识到的，hh~）</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="二维码使用">二维码使用<a class="hash-link" href="#二维码使用" title="标题的直接链接">​</a></h3><p>只需要将升级成lab固件版本的gopro打开后对准我们的二维码，就会自动识别并应用了，然后“BOOM”，一个可爱的浮层就出现了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360991571-d8d1b7e0310840ea24d4942d811b06c8afce5eb567d92a10db6ca0642adcd2f5.png" alt="picture 18" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="缺陷">缺陷<a class="hash-link" href="#缺陷" title="标题的直接链接">​</a></h3><ol><li>除了上文提到的容易导致系统挂掉之外，正常操作不会有问题</li><li>经测试，我们的时间戳浮层对照片和夜间延时没有效果，对普通视频与正常延时有效果。经过思考，我这个项目一开始采用夜间延时的方案现在觉得不太适用，因为实测下来在夜间我屋子几乎全黑的环境下即使开了夜间延时也几乎无法拍出能看清的画面，而白天看投影时又会导致曝光过高，因此直接放弃夜间的效果即可。当初拍夜间是为了监测睡眠，那段时间也会在睡觉时留一盏小灯（戴眼罩）以获得最好的拍摄效果，现在睡眠项目已经结项了，因此不需要了。我也更喜欢无声+全黑的睡眠环境。</li><li>关于上一点，也好像不是没有解决方案，正如我笔记中记载的 <a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a> 这篇帖子里的小哥貌似碰到的就是和我差不多的问题并有一个解决方案，但我暂时已经不需要了，以后有机会再研究吧！</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他用处">其他用处<a class="hash-link" href="#其他用处" title="标题的直接链接">​</a></h3><p>GoPro Labs的功能不仅限于添加浮层这一项，恰恰相反，这是里面最小的一个应用之一。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655361326041-ae5359c76c082cda93c03f928c7e5ad513c1636b7dd46f1865dbf5e6b75e3da9.png" alt="picture 19" class="img_ev3q">  </p><p>它还有很多其他有趣的场景应用，必须运动检测、自动切换模式等，详情可参考：</p><ul><li><p><a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p><a href="https://www.youtube.com/watch?v=YaXcu0E10WM" target="_blank" rel="noopener noreferrer">(151) GoPro Labs: How to Use QR Codes to Instantly Switch Your Settings - YouTube</a></p></li><li><p><a href="https://www.youtube.com/watch?v=0LCGiO7jMEw" target="_blank" rel="noopener noreferrer">(151) GoPro Labs 2021 New Features for Hero 9, Max, Hero 8, Hero 7: Hands-on Details &amp; Explainer - YouTube</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="方案3个人笔记">*方案3个人笔记<a class="hash-link" href="#方案3个人笔记" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab01-how-to-install-the-labs-firmware">LAB01: how to install the labs firmware<a class="hash-link" href="#lab01-how-to-install-the-labs-firmware" title="标题的直接链接">​</a></h3><p>see <a href="https://gopro.com/en/us/support/hero9-black-product-update" target="_blank" rel="noopener noreferrer">Hero9 Black Product Update | GoPro</a>, but I failed to generate the target firmware in this site.</p><p>So I downloaded it in other place, e.g. - <a href="https://www.goproforums.com/threads/need-hero9-black-firmware-update-v1-5.87636/" target="_blank" rel="noopener noreferrer">Need HERO9 Black firmware update v1.5 | GoPro Forums</a>, which directed me to the dropbox download page: - <a href="https://www.dropbox.com/s/edh41nffo6d6gns/GoPro%20Hero%209%20firmwares%20fishycomics.zip?dl=0" target="_blank" rel="noopener noreferrer">GoPro Hero 9 firmwares fishycomics.zip</a></p><p>And finally, I saved two different firmwares in local disk, one for stable version, one for the lib one:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655351979322-5f9d394f99b48f506a3fb28de9adadfd94be9ebc9f57562d3925e88635f16863.png" alt="picture 2" class="img_ev3q">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655340186034-7e904daaa952ca0a5c3457c103fcddaa9eaee79362a7051a179ef1ca14576416.png" alt="picture 1" class="img_ev3q">  </p><p>ref:</p><ul><li><a href="https://community.gopro.com/s/article/GoPro-Labs?language=en_US" target="_blank" rel="noopener noreferrer">GoPro Labs Information</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab02-qr-controls-for-settings">LAB02: QR Controls For Settings<a class="hash-link" href="#lab02-qr-controls-for-settings" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><p>documentation: <a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p>custom qr control: <a href="https://gopro.github.io/labs/control/custom/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/custom/</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab03-add-an-overlay-to-viedeo">LAB03: add an overlay to viedeo<a class="hash-link" href="#lab03-add-an-overlay-to-viedeo" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a></li></ul><p>ref:</p><ul><li><p><a href="https://community.gopro.com/s/question/0D53b00008HOPq7CAH/how-do-i-add-timestamp-to-hero-10-videos?language=en_US" target="_blank" rel="noopener noreferrer">How do I add timestamp to Hero 10 videos?</a></p></li><li><p><a href="https://www.reddit.com/r/gopro/comments/pt6u8j/burning_timestamp_on_gopro_movie/" target="_blank" rel="noopener noreferrer">Burning timestamp on GoPro movie : gopro</a></p></li></ul><p>bugfix: gopro labs won&#x27;t add timestamp to interval videos, see:</p><ul><li><a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="最后一点感受">最后一点感受<a class="hash-link" href="#最后一点感受" title="标题的直接链接">​</a></h2><p>国外的极客生态真地很繁荣，一个小小的gopro就能玩出这么多的花样，反观国内，似乎还停留在各种参数的堆砌与各种大饼的圈画上，实则看不到太多对待一个具体的事物（而非钱）研究的诚意与专注的热爱。</p><p>之前携国货之光大疆无人机奔赴川藏线，它真地很好。但现在身处帝都，最终还是无用武之地，幸好有位天体物理博士愿意收购它，让它继续发光发热。而我，则只有尽我可能，把一些有趣的东西搞的更明白一些、更有用一些、更好玩一些。</p><p>gopro的话题，从上篇的open-gopro到本篇的GoPro Labs，基本已经涉及了gopro核心开发生态的方方面面，朋友们需要时完全可以顺着这两篇一窥gopro的里子，进而玩出新的花样。</p><p>下一期，我们聊聊最近做的另外一个有趣的小东西：投影与手机遥控器。</p><p>Best Wishes to All of You.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/markshawn2020/keeps-learning/edit/master/docs/Notes/uploaded/gopro-timestamp.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2022-07-27T08:09:54.000Z">2022年7月27日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/keeps-learning/docs/Notes/uploaded/douban_rent-houses/mark_rent-house-research"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">南川核心应用笔记 | 北京租房系统设计、研究与经验 0.1.0</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/keeps-learning/docs/Notes/uploaded/ios-automation"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">深度技术分享 | iOS自动化实现王者荣耀一键换装</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#方案1物理手段解决" class="table-of-contents__link toc-highlight">方案1：物理手段解决</a></li><li><a href="#方案2借助opencv基于文件创建时间进行推算" class="table-of-contents__link toc-highlight">方案2：借助<strong>OpenCV</strong>基于文件创建时间进行推算</a></li><li><a href="#方案3借助gopro-labs添加时间戳浮层" class="table-of-contents__link toc-highlight">方案3：借助<strong>GoPro Labs</strong>添加时间戳浮层</a><ul><li><a href="#浮层大小" class="table-of-contents__link toc-highlight">浮层大小</a></li><li><a href="#浮层内容" class="table-of-contents__link toc-highlight">浮层内容</a></li><li><a href="#浮层位置" class="table-of-contents__link toc-highlight">浮层位置</a></li><li><a href="#二维码生成" class="table-of-contents__link toc-highlight">二维码生成</a></li><li><a href="#二维码使用" class="table-of-contents__link toc-highlight">二维码使用</a></li><li><a href="#缺陷" class="table-of-contents__link toc-highlight">缺陷</a></li><li><a href="#其他用处" class="table-of-contents__link toc-highlight">其他用处</a></li></ul></li><li><a href="#方案3个人笔记" class="table-of-contents__link toc-highlight">*方案3个人笔记</a><ul><li><a href="#lab01-how-to-install-the-labs-firmware" class="table-of-contents__link toc-highlight">LAB01: how to install the labs firmware</a></li><li><a href="#lab02-qr-controls-for-settings" class="table-of-contents__link toc-highlight">LAB02: QR Controls For Settings</a></li><li><a href="#lab03-add-an-overlay-to-viedeo" class="table-of-contents__link toc-highlight">LAB03: add an overlay to viedeo</a></li></ul></li><li><a href="#最后一点感受" class="table-of-contents__link toc-highlight">最后一点感受</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/keeps-learning/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/keeps-learning/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/keeps-learning/assets/js/runtime~main.3430d87e.js"></script>
<script src="/keeps-learning/assets/js/main.7d0120fb.js"></script>
</body>
</html>