<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/keeps-learning/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/keeps-learning/blog/atom.xml" title="南川笔记 Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Manual/bugfix of compiling arpara hmdservice on AOSP 10 | 南川笔记</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/keeps-learning/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Manual/bugfix of compiling arpara hmdservice on AOSP 10 | 南川笔记"><meta data-rh="true" name="description" content="一些已知的问题，主要集中在环境配置与语法层面，实际效果还未知，usb接口变动的事则值得注意"><meta data-rh="true" property="og:description" content="一些已知的问题，主要集中在环境配置与语法层面，实际效果还未知，usb接口变动的事则值得注意"><link data-rh="true" rel="icon" href="/keeps-learning/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/keeps-learning/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/keeps-learning/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/keeps-learning/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10" hreflang="x-default"><link rel="stylesheet" href="/keeps-learning/assets/css/styles.6bbfa55a.css">
<link rel="preload" href="/keeps-learning/assets/js/runtime~main.2c4d9993.js" as="script">
<link rel="preload" href="/keeps-learning/assets/js/main.2e9b1d76.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/keeps-learning/"><div class="navbar__logo"><img src="/keeps-learning/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/keeps-learning/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">南川笔记</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/keeps-learning/docs/">My Docs</a><a class="navbar__item navbar__link" href="/keeps-learning/blog">My Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/keeps-learning" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keeps-learning/docs/">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keeps-learning/docs/TODO">TODO</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/keeps-learning/docs/SLAM/A01-recognizeLights">SLAM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/A01-recognizeLights">A01: recognize lights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/slam-research">slam-research</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/slambook2-ch13">slambook2-ch13</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/SLAM/slambook2-learning">slambook2-learning</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/keeps-learning/docs/AndroidFramework/TaskA1-aosp-pull/aosp-pull">AndroidFramework</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA1-aosp-pull/aosp-pull">TaskA1-aosp-pull</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA2-aosp-compile/aosp-compile-bugfix">TaskA2-aosp-compile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA3-aosp-changes/aosp-changes">TaskA3-aosp-changes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA4-sf-research/arpara-distortion-logic">TaskA4-sf-research</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA5-sf-patches/sf-patch-research-2021">TaskA5-sf-patches</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA6-aosp-read/aosp-read-howto">TaskA6-aosp-read</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskA7-aosp-coding/aosp-coding-howto">TaskA7-aosp-coding</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10">TaskB1-hmdservice-compile</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10">Manual/bugfix of compiling arpara hmdservice on AOSP 10</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskB2-hmdservice-integration/native-service-integration-howto">TaskB2-hmdservice-integration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskC1-timewarp/tw-bugfix">TaskC1-timewarp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskC2-opengl/opengl-howto">TaskC2-opengl</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskD1-arpara-glass/arpara-glass-howto">TaskD1-arpara-glass</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/TaskE1-rockchip4/depreciated/depreciated-rockchip4-howto">TaskE1-rockchip4</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/AndroidFramework/adb-howto">adb howto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/AndroidFramework/arpara-vr-logic">arpara vr logic</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/keeps-learning/docs/AndroidFramework/depreciated/TaskA6-emulator/emulator-howto">depreciated</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/AndroidFramework/frameworks-howto">frameworks howto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/keeps-learning/docs/AndroidFramework/mark_vr-principle-and-implementation">南川核心研发笔记 | VR系统原理与设计实现</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/Coding/CPP/cpp-howto">Coding</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/Notes/blog-investigation">Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/OS/Linux/centos-init-manual">OS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/keeps-learning/docs/Softwares/Adobe/PS/support-for-little-stars/">Softwares</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keeps-learning/docs/TODO-closed">TODO-closed</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/keeps-learning/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AndroidFramework</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TaskB1-hmdservice-compile</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Manual/bugfix of compiling arpara hmdservice on AOSP 10</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.16.0+</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Manual/bugfix of compiling arpara hmdservice on AOSP 10</h1><blockquote><p>一些已知的问题，主要集中在环境配置与语法层面，实际效果还未知，usb接口变动的事则值得注意</p></blockquote><ol><li><a href="#%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82">环境要求</a></li><li><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E6%9C%AC%E5%9C%B0%E7%A4%BA%E4%BE%8B">全局变量（本地示例）</a></li><li><a href="#%E7%BC%96%E8%AF%91%E6%80%BB%E8%A7%88">编译总览</a></li><li><a href="#step-1-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE">step 1. 初始化项目</a><ol><li><a href="#fix-1-glm-%E8%B7%AF%E5%BE%84%E4%BF%AE%E6%AD%A3">fix 1. <code>glm</code> 路径修正</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E6%8B%B7%E8%B4%9D">项目拷贝</a></li><li><a href="#androidmk-%E9%85%8D%E7%BD%AE"><code>Android.mk</code> 配置</a><ol><li><a href="#fix-2-libusbhost">fix 2. <code>libusbhost</code></a></li><li><a href="#fix-3-local_cflags">fix 3. <code>LOCAL_CFLAGS</code></a></li><li><a href="#androidmk-%E4%BA%8B%E5%85%88%E7%BC%96%E8%BE%91%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7">Android.mk 事先编辑的重要性</a></li></ol></li></ol></li><li><a href="#step-2-usb-%E6%8E%A5%E5%8F%A3%E4%BF%AE%E5%A4%8D">step 2. usb 接口修复</a><ol><li><a href="#%E4%BF%AE%E5%A4%8D%E9%9C%80%E8%A6%81%E6%96%B0%E5%A2%9Etimeout%E7%9A%84%E4%B8%89%E4%B8%AA%E6%8E%A5%E5%8F%A3manufacture--product--serial%E5%8D%95%E4%BD%8D%E6%98%AF%E6%AF%AB%E7%A7%92%E7%9B%AE%E5%89%8D%E6%94%B9%E6%88%90%E4%BA%865000">修复需要新增<code>timeout</code>的三个接口<code>manufacture | product | serial</code>，单位是毫秒，目前改成了5000</a></li><li><a href="#%E5%88%A0%E9%99%A4name%E6%B2%A1%E6%9C%89%E7%94%A8%E5%88%B0%E6%8E%A5%E5%8F%A3%E4%B9%9F%E5%8F%98%E4%BA%86%E7%9A%84%E4%B8%80%E5%8F%A5%E4%BB%A3%E7%A0%81">删除<code>*name</code>没有用到，接口也变了的一句代码</a></li></ol></li><li><a href="#step-3-%E4%BB%A3%E7%A0%81%E8%AF%AD%E6%B3%95%E4%BF%AE%E5%A4%8D">step 3. 代码语法修复</a><ol><li><a href="#white_check_mark-fall-through">✅ <code>fall through</code></a></li><li><a href="#white_check_mark-%E5%88%A0%E9%99%A4%E7%A9%BA%E6%8C%87%E9%92%88%E9%97%AE%E9%A2%98%E8%BD%AC%E4%B8%BA%E8%B5%8B%E5%80%BC%E4%B8%BA%E7%A9%BA%E6%8C%87%E9%92%88">✅ 删除空指针问题，转为赋值为空指针</a></li><li><a href="#white_check_mark-%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">✅ 其他一些类型转换</a></li></ol></li><li><a href="#%E7%BC%96%E8%AF%91%E6%88%90%E5%8A%9F%E6%95%88%E6%9E%9C">编译成功效果</a><ol><li><a href="#sparkles-build-success-of-libhmdservice">✨ build success of <code>libhmdservice</code></a></li><li><a href="#sparklessparkles-build-success-of-hmdservice">✨✨ build success of <code>hmdservice</code></a></li></ol></li><li><a href="#%E5%BC%95%E7%94%B3%E9%98%85%E8%AF%BB%E5%85%B6%E4%BB%96%E5%88%86%E6%9E%90">引申阅读/其他分析</a><ol><li><a href="#translate-androidmk">translate <code>Android.mk</code></a></li><li><a href="#white_check_mark-androidbp-path-is-outside-directory">✅ <code>Android.bp: Path is outside directory</code></a></li><li><a href="#white_check_mark-error-frameworksnativeserviceshmdserviceservice-moduletargetshared_librarieslibhmdservice-already-defined-by-frameworksnativeserviceshmdserviceservice">✅ <code>error: frameworks/native/services/hmdservice/service: MODULE.TARGET.SHARED_LIBRARIES.libhmdservice already defined by frameworks/native/services/hmdservice/service.</code></a></li><li><a href="#white_check_mark-fatal-error-usbhostusbhosth-file-not-found">✅ <code>fatal error: &#x27;usbhost/usbhost.h&#x27; file not found</code></a></li><li><a href="#usb-cover-progress">usb cover progress</a><ol><li><a href="#white_check_mark-error-no-matching-function-for-call-to-usb_device_get_manufacturer_name">✅ <code>error: no matching function for call to &#x27;usb_device_get_manufacturer_name&#x27;</code></a></li><li><a href="#white_check_mark-error-no-matching-function-for-call-to-usb_device_get_string">✅ <code>error: no matching function for call to &#x27;usb_device_get_string&#x27;</code></a></li></ol></li><li><a href="#white_check_mark-error-unknown-type-name-usb_device-did-you-mean-usbdevice">✅ <code>error: unknown type name &#x27;usb_device&#x27;; did you mean &#x27;UsbDevice&#x27;?</code></a></li><li><a href="#white_check_mark-%E5%8F%98%E9%87%8F%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8E%E6%89%8B%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B%E6%94%BE%E5%BC%83%E5%90%8E%E6%9D%A5%E7%9B%B4%E6%8E%A5%E9%85%8Dmk%E4%BA%86">✅ 变量没有使用的情况与手动修复过程（放弃，后来直接配mk了）</a></li><li><a href="#white_check_mark-failed-ninja-frameworksnativeserviceshmdserviceserviceframeworksnativeserviceshmdserviceservicecommonihmdservercpp-needed-by-outtargetproductgeneric_arm64objshared_librarieslibhmdservice_intermediatesframeworksnativeserviceshmdserviceservicecommonihmdservero-missing-and-no-known-rule-to-make-it">✅ <code>FAILED: ninja: &#x27;frameworks/native/services/hmdservice/service/frameworks/native/services/hmdservice/service/common/IHmdServer.cpp&#x27;, needed by &#x27;out/target/product/generic_arm64/obj/SHARED_LIBRARIES/libhmdservice_intermediates/frameworks/native/services/hmdservice/service/common/IHmdServer.o&#x27;, missing and no known rule to make it</code></a></li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="环境要求">环境要求<a class="hash-link" href="#环境要求" title="标题的直接链接">​</a></h2><ul><li>需要有<code>android 10+</code>的整编环境。</li><li>需要有<code>arpara hmdservice</code>的一套代码。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="全局变量本地示例">全局变量（本地示例）<a class="hash-link" href="#全局变量本地示例" title="标题的直接链接">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ARPARA=$HOME/work@luci/immerex/arpara-hmdservice    # change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AOSP=~/arpara/android/android-10.0.0_r1             # change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NATIVE=$AOSP/frameworks/native                      # no need to change</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="编译总览">编译总览<a class="hash-link" href="#编译总览" title="标题的直接链接">​</a></h2><ol><li>之前纠结了好久<code>mk</code>转<code>bp</code>的问题，也转过，也能用，后来发现没有必要，<code>Android 10</code>会自己检测有没有<code>mk</code>或者<code>bp</code>文件，然后都可以编，两个文件不能同时有（准确地说，是里面的内容不能有重合，比如两个模块名一样），否则会报<code>XXX has declared</code>错。</li><li>所以这里推荐，也不用转了，直接基于目前的 <code>Android.mk</code> 改，不然后期不太好和杭州同学同步维护，主要现在 <code>Android.mk</code> 还有很大问题，可能会一直修改，没有成型，那转出来的 <code>bp</code> 也是没成型的，后期到底是改 <code>mk</code> 还是改 <code>bp</code> 这就涉及到一个同步问题。</li><li>目前的共识是只要跑一个service即可，观察<code>service</code>目录结构，，会发现虽然有两个<code>Android.mk</code>文件，但是核心是<code>service/hmdservice/service/Android.mk</code>这个文件，里面有两个模块名，一个叫<code>libhmdservice</code>这是服务端，一个叫<code>hmdservice</code>这是客户端，客户端依赖于服务端，所以可以先编服务端，直接<code>m libhmdservice</code>即可，编好后可以再编客户端，直接<code>m hmdservice</code>接口。</li><li>编完后，<code>externals</code>里面的文件与模块都会打包到<code>hmdservice/service</code>目录下，如下，可以看到原先用<code>..</code>等引用的文件目录现在都同级了。
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643325369686-dbf6353e65673ccf50dc225bb0813c756654bd5e9050afeb884fd2e25ce230c2.png" alt="picture 155" class="img_ev3q">  </li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-初始化项目">step 1. 初始化项目<a class="hash-link" href="#step-1-初始化项目" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fix-1-glm-路径修正">fix 1. <code>glm</code> 路径修正<a class="hash-link" href="#fix-1-glm-路径修正" title="标题的直接链接">​</a></h3><p>景喆发我的sdk里，核心是<code>service</code>与<code>externals</code>两个文件夹。</p><p>其中 <code>externals</code> 文件夹的目录结构如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643324368419-b20be18152a2cbb0d1e959033ebf5fa4cd46036cb96a46447d6c733971ee82ab.png" alt="picture 152" class="img_ev3q">  </p><p>注意，<code>glm</code>作为外部库，实际起作用的是绿框部分。</p><p>但是在 <code>Android.mk</code> 文件内配置的路径却为：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643324448613-5fe847f970fa6c394982b88ecb1935008e29a30603ea1d2670f09f26dfc39e07.png" alt="picture 153" class="img_ev3q">  </p><p>这是不对的，这样编译，会导致 <code>glm</code> 下的所有文件都找不到。</p><p>在不改变文件结构的情况下，可以直接修改 <code>Android.mk</code> 将 <code>glm</code>层级加深一级。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643324597991-133228183c45f0a6d5257c2bdaeaf8bcebf5b61543b6e7c0668f2b0aac83e33a.png" alt="picture 154" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="项目拷贝">项目拷贝<a class="hash-link" href="#项目拷贝" title="标题的直接链接">​</a></h3><p>接着将 <code>arpara-hmdservice</code> 的一套代码直接拷贝到 <code>native</code> 下，保持目录结构。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp -r $ARPARA/* $NATIVE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="androidmk-配置"><code>Android.mk</code> 配置<a class="hash-link" href="#androidmk-配置" title="标题的直接链接">​</a></h3><p>考虑目前采用 <code>Android.mk</code> 方案，所以 <code>bp</code> 就不管了。</p><p>刚刚其实已经说了一个<code>Android.mk</code>的配置改动，关于 <code>glm</code> 的，这还是第一步。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fix-2-libusbhost">fix 2. <code>libusbhost</code><a class="hash-link" href="#fix-2-libusbhost" title="标题的直接链接">​</a></h4><p>第二步，一个很大的坑，就是<code>hmdservice</code>下面没有引入静态库<code>libusbhost</code>，这会导致<code>#include &lt;usbhost/usbhost.h&gt;</code>失效。所以要补上。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643326614099-58e2901ab04c381add6deb8145ad7be1ff18f87c1096c7e7d13d8e6476783544.png" alt="picture 158" class="img_ev3q">  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fix-3-local_cflags">fix 3. <code>LOCAL_CFLAGS</code><a class="hash-link" href="#fix-3-local_cflags" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643319315149-0ef8f4f36eae75de9e0544938317df9ae16c51e7e9b818e4885023b7ba13fbec.png" alt="picture 147" class="img_ev3q">  </p><p>基于以上认识，有必要对某些错误进行抑制，变量未使用的错误基本无关痛痒的，format不匹配一般也不会引发程序错误，尤其是在<code>print</code>函数中或者向上转换时。</p><p>因此修改<code>Android.mk</code>如下，否则编译不过。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643327867425-d299e3defc90f9470ab7645780f39e2098f6ecfdb59862c67ae2b4424235d0bb.png" alt="picture 160" class="img_ev3q">  </p><p>具体可参考：<a href="#white_check_mark-%E5%8F%98%E9%87%8F%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8E%E6%89%8B%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B%E6%94%BE%E5%BC%83%E5%90%8E%E6%9D%A5%E7%9B%B4%E6%8E%A5%E9%85%8Dmk%E4%BA%86">✅ 变量没有使用的情况与手动修复过程（放弃，后来直接配mk了）</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="androidmk-事先编辑的重要性">Android.mk 事先编辑的重要性<a class="hash-link" href="#androidmk-事先编辑的重要性" title="标题的直接链接">​</a></h4><p>由于每次 <code>Android.mk</code> 改动后，即使是编译该文件夹下的一个小模块，也会触发全局/局部刷新，导致编译变慢，所以尽量一次性先配好 <code>Android.mk</code>，后续就不用改配置，直接改代码，编译就会很快。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-usb-接口修复">step 2. usb 接口修复<a class="hash-link" href="#step-2-usb-接口修复" title="标题的直接链接">​</a></h2><p>具体分析可跳转：<a href="#usb-cover-progress">usb cover progress</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修复需要新增timeout的三个接口manufacture--product--serial单位是毫秒目前改成了5000">修复需要新增<code>timeout</code>的三个接口<code>manufacture | product | serial</code>，单位是毫秒，目前改成了5000<a class="hash-link" href="#修复需要新增timeout的三个接口manufacture--product--serial单位是毫秒目前改成了5000" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd $NATIVE/services/hmdservice/service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add `timeout` param since api changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|usb_device_get_manufacturer_name(device)|usb_device_get_manufacturer_name(device, 5000)|&quot; HmdDeviceManager.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|usb_device_get_product_name(device)|usb_device_get_product_name(device, 5000)|&quot; HmdDeviceManager.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|usb_device_get_serial(device)|usb_device_get_serial(device, 5000)|&quot; HmdDeviceManager.cpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="删除name没有用到接口也变了的一句代码">删除<code>*name</code>没有用到，接口也变了的一句代码<a class="hash-link" href="#删除name没有用到接口也变了的一句代码" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd $NATIVE/services/hmdservice/service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> # drop `*name` which is useless and out-of-dated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;76s|(.*)|//\1|&quot; HmdDevice.cpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-代码语法修复">step 3. 代码语法修复<a class="hash-link" href="#step-3-代码语法修复" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-fall-through">✅ <code>fall through</code><a class="hash-link" href="#-fall-through" title="标题的直接链接">​</a></h3><p>这是一个case下没有break，我浏览了一下，99%确定应该是要加break的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643319911393-50ae8f67ca3dde5e6da651689cb03f8317f77c4ed4ab25708007965c723629db.png" alt="picture 148" class="img_ev3q"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643327972429-8aae1f5b4e3e1dde1e3095a8ebebaf6c045c282fed81d168e23bffa86a6d25a8.png" alt="picture 161" class="img_ev3q">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643327995369-fe01fc0318a9a5f60dcbece1527c1131bfe93c6000d53111debe0fa75054ccd6.png" alt="picture 162" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-删除空指针问题转为赋值为空指针">✅ 删除空指针问题，转为赋值为空指针<a class="hash-link" href="#-删除空指针问题转为赋值为空指针" title="标题的直接链接">​</a></h3><p>有一些空指针删除问题，个人采用了赋值为空指针，抑制了报错，我也不是C++专家，如果我的做法有误，有副作用，请指正，感觉应该是对的。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;s|delete (\w+)|\1 = nullptr|&quot; HmdService.cpp HmdDevice.cpp HmdDeviceManager.cpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643328380750-e31f9a278f13d5e620901fafc55e47784ebd8761a4d1486a23555b2a95bb5a47.png" alt="picture 163" class="img_ev3q">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643328390889-062fd6f65e1bf48114fdb3b734bb96c159a8d87ad781643f1bf2e64558b3f53b.png" alt="picture 164" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-其他一些类型转换">✅ 其他一些类型转换<a class="hash-link" href="#-其他一些类型转换" title="标题的直接链接">​</a></h3><p>整型类型转换当时在处理时碰到了点bug，有点像环，有三个函数里面的变量怎么换都不对……</p><p>考虑到类型转换对程序正确性影响不大，而且那几个主要用于打印的，不是做实际计算，所以最后我把它加入到了<code>LOCAL_CFLAGS</code>里了，就是那个<code>-Wno-format</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="编译成功效果">编译成功效果<a class="hash-link" href="#编译成功效果" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-build-success-of-libhmdservice">✨ build success of <code>libhmdservice</code><a class="hash-link" href="#-build-success-of-libhmdservice" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643323418539-6548090679139c81754a84cd47460ed9f75d42d34d6185df1b4a5559ce8efbb2.png" alt="picture 149" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-build-success-of-hmdservice">✨✨ build success of <code>hmdservice</code><a class="hash-link" href="#-build-success-of-hmdservice" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643323611443-cb33ef62710df8e38b1955d02e861426351f18854017a51f7ff94c8a0298eb1b.png" alt="picture 150" class="img_ev3q">  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="引申阅读其他分析">引申阅读/其他分析<a class="hash-link" href="#引申阅读其他分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="translate-androidmk">translate <code>Android.mk</code><a class="hash-link" href="#translate-androidmk" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ANDROIDMK=`out/soong/host/linux-x86/bin/$ANDROID`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ln -s $ANDROIDMK /usr/local/bin/androidmk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd $NATIVE/services/hmdservice/service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">androidmk Android.mk &gt; Android.bp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643307094247-9112acf9b4488e6cbd159319c39ffe544e8fa9d372c5066243b9459cc7f86cbd.png" alt="picture 126" class="img_ev3q">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643307152936-a88f99c9cdbd14f646b4db367085a8bf64390eb4e4a93ac50717d86563c2763d.png" alt="picture 127" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-androidbp-path-is-outside-directory">✅ <code>Android.bp: Path is outside directory</code><a class="hash-link" href="#-androidbp-path-is-outside-directory" title="标题的直接链接">​</a></h3><p>problem:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643307338978-a81179a15f28f671b97b7bb5f04ed4d8c527b279d3ec0042e18a3cc0b0465ceb.png" alt="picture 128" class="img_ev3q">  </p><p>analysis:</p><p>There are not too many refs, so we can simply move them to under <code>service/hmdservice/service</code>.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643307400267-e04276fbe02a1bfe6f470716a4bd7800ac41625f0e31db7727ba9fcd2b96085c.png" alt="picture 129" class="img_ev3q">  </p><p>resolution:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd services/hmdservice/service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv ../../../externals/glm ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|../../../externals/glm|glm|g&quot; Android.bp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv ../common .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|../common|common|g&quot; Android.bp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv ../cv .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|../cv|cv|g&quot; Android.bp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m hmdservice</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>result:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643308322613-edc2554631fc57cd30e3d2c86d20d0086130ddde315a935c733e0530d487fe23.png" alt="picture 130" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-error-frameworksnativeserviceshmdserviceservice-moduletargetshared_librarieslibhmdservice-already-defined-by-frameworksnativeserviceshmdserviceservice">✅ <code>error: frameworks/native/services/hmdservice/service: MODULE.TARGET.SHARED_LIBRARIES.libhmdservice already defined by frameworks/native/services/hmdservice/service.</code><a class="hash-link" href="#-error-frameworksnativeserviceshmdserviceservice-moduletargetshared_librarieslibhmdservice-already-defined-by-frameworksnativeserviceshmdserviceservice" title="标题的直接链接">​</a></h3><p>analysis:</p><p>In fact, the error may owes to the duplicated definition by both <code>Android.mk</code> and <code>Android.bp</code>.</p><p>resolution:</p><p>Delete or bak the <code>Android.mk</code>.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># service/hmdservice/service/Android.mk [core]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># maybe no need, but for explicitly using `Android.bp`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv Android.mk Android.mk.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># service/hmdservice/Android.mk [redundant]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv ../Android.mk ../Android.mk.bak</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><p>The former resolution may be right, but after then I changed back to <code>Android.mk</code>, hence the errors arise again.</p><p>reason:</p><p>I&#x27;m silly since I used <code>cp</code> again to have generated an <code>Android.bp.bak</code> so that there are `Androi</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-fatal-error-usbhostusbhosth-file-not-found">✅ <code>fatal error: &#x27;usbhost/usbhost.h&#x27; file not found</code><a class="hash-link" href="#-fatal-error-usbhostusbhosth-file-not-found" title="标题的直接链接">​</a></h3><p>problem:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643309016631-58f9e2f7b0d674c10ed3d222c77c02e24ae12cdab12cfee7866ea0d97fd8721b.png" alt="picture 131" class="img_ev3q">  </p><p>resolution:</p><p>just comment/delete that line.</p><p>result:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643309450092-da8e3e51f68cb408eef7097c16369628521839b0e5094e92cf63bbad6b45b34d.png" alt="picture 132" class="img_ev3q">  </p><p>wrong!</p><hr><p>analysis:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643310177554-57f83166b9b997424737e2765d2e55c9ee7772dbc86a1cece965f0150ce5ce15.png" alt="picture 133" class="img_ev3q">  </p><p>resolution:</p><p>don&#x27;t comment it.</p><p>and then it seems ok now.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643310248334-49665e1ff7c04cdf40b6e9a8d3b6b6c242b6cb2779e55f8365305153c25ecd5a.png" alt="picture 134" class="img_ev3q">  </p><p>wrong!</p><hr><p>resolution:</p><p>compile the <code>usbhost</code> first.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643311568636-edecb257058c690a14f0cca66007371acbe2bd218657e9ab407dbb1851186779.png" alt="picture 136" class="img_ev3q">  </p><p>wrong!</p><hr><p>analysis:</p><p>The <code>usbhost</code> is not alone only from under <code>sys</code>.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643311965426-5738d84bc2fdf6deab2e95a50dd0008968d8fe383c5e310dd32a4ea6b1f67071.png" alt="picture 137" class="img_ev3q">  </p><p>So why only <code>usbhost</code> raises error?</p><p>One reason mey be that it isn&#x27;t included in the <code>Android.bp</code> while others like <code>String8.h</code> of lib <code>libutils</code> is.</p><p>Awful! That&#x27;s it!</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643312190595-c6352cb9bbb21c1f76c47429967746ff28ffd19734cc2d910cc09682ebeda4cd.png" alt="picture 138" class="img_ev3q">  </p><p>And okay!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="usb-cover-progress">usb cover progress<a class="hash-link" href="#usb-cover-progress" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="-error-no-matching-function-for-call-to-usb_device_get_manufacturer_name">✅ <code>error: no matching function for call to &#x27;usb_device_get_manufacturer_name&#x27;</code><a class="hash-link" href="#-error-no-matching-function-for-call-to-usb_device_get_manufacturer_name" title="标题的直接链接">​</a></h4><p>analysis:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643312994745-efcdee1fb2404efb3e4856530fa8af6fa13753f898b67565a92e112d60ea4d2c.png" alt="picture 139" class="img_ev3q">  </p><p>Obviously! It&#x27;s because api change!</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643313212330-a3b0b516376b57536e5959d682d9d6b13cade24be0f589eb5112f4482085ccf0.png" alt="picture 140" class="img_ev3q">  </p><p>resolution:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|usb_device_get_manufacturer_name(device)|usb_device_get_manufacturer_name(device, 5000)|&quot; HmdDeviceManager.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|usb_device_get_product_name(device)|usb_device_get_product_name(device, 5000)|&quot; HmdDeviceManager.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s|usb_device_get_serial(device)|usb_device_get_serial(device, 5000)|&quot; HmdDeviceManager.cpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>extended reading:</p><ul><li><code>timeout</code> unit is <code>ms</code>: <a href="https://www.ftdichip.com/Support/Knowledgebase/index.html?usbtimeout.htm" target="_blank" rel="noopener noreferrer">FTDI Knowledgebase</a></li></ul><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643313605044-e7a4aaeff480b32897c9580e9b8b99ea4999c2d8f6c0889b3a96e33ef300e9d3.png" alt="picture 141" class="img_ev3q">  </p><ul><li>usbhost definition: <a href="http://docs.ros.org/en/kinetic/api/librealsense2/html/usbhost_8h.html#a4a0722741758e228eea537a8d6f78a23" target="_blank" rel="noopener noreferrer">librealsense2: usbhost.h File Reference</a></li></ul><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643313640291-f473da436be2b06b1a35c261445783d17b2b9cd4b13b78217bbb809801f0f682.png" alt="picture 142" class="img_ev3q">  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="-error-no-matching-function-for-call-to-usb_device_get_string">✅ <code>error: no matching function for call to &#x27;usb_device_get_string&#x27;</code><a class="hash-link" href="#-error-no-matching-function-for-call-to-usb_device_get_string" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643314676811-c9751f6c959f85f7984802217366367ea4412a25888e6a5038eef8c931838743.png" alt="picture 143" class="img_ev3q">  </p><p>resolution:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># drop *name which is useless and out-of-dated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;76s|(.*)|//\1|&quot; HmdDevice.cpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>drop the line since useless and out-of-date.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643315231955-9f573c133950bd0c1198bd98e4a1173c88671fd7195046ee76a5a1a38e8f7407.png" alt="picture 144" class="img_ev3q">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643315348108-f44479f0d9247cb8849c39c1be83fe2727c1628594207756bc022d621e5ef1e8.png" alt="picture 145" class="img_ev3q">  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-error-unknown-type-name-usb_device-did-you-mean-usbdevice">✅ <code>error: unknown type name &#x27;usb_device&#x27;; did you mean &#x27;UsbDevice&#x27;?</code><a class="hash-link" href="#-error-unknown-type-name-usb_device-did-you-mean-usbdevice" title="标题的直接链接">​</a></h3><p>reason:</p><p>I commented the <code>usbhost.h</code></p><p>resolution:</p><p>Add it back.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-变量没有使用的情况与手动修复过程放弃后来直接配mk了">✅ 变量没有使用的情况与手动修复过程（放弃，后来直接配mk了）<a class="hash-link" href="#-变量没有使用的情况与手动修复过程放弃后来直接配mk了" title="标题的直接链接">​</a></h3><p>problem:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643310792765-8d0f4c98a3ea3dc027642153dbb7d35e1f0cc605e2f89b92276ba688a2b1c10b.png" alt="picture 135" class="img_ev3q">  </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;494s|(.*)|//\1|&quot; HmdService.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;258s|(.*)|//\1|&quot; HmdService.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;262s|(.*)|//\1|&quot; HmdService.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># uncomment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;494s|^//||&quot; HmdService.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;258s|^//||&quot; HmdService.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;262s|^//||&quot; HmdService.h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-failed-ninja-frameworksnativeserviceshmdserviceserviceframeworksnativeserviceshmdserviceservicecommonihmdservercpp-needed-by-outtargetproductgeneric_arm64objshared_librarieslibhmdservice_intermediatesframeworksnativeserviceshmdserviceservicecommonihmdservero-missing-and-no-known-rule-to-make-it">✅ <code>FAILED: ninja: &#x27;frameworks/native/services/hmdservice/service/frameworks/native/services/hmdservice/service/common/IHmdServer.cpp&#x27;, needed by &#x27;out/target/product/generic_arm64/obj/SHARED_LIBRARIES/libhmdservice_intermediates/frameworks/native/services/hmdservice/service/common/IHmdServer.o&#x27;, missing and no known rule to make it</code><a class="hash-link" href="#-failed-ninja-frameworksnativeserviceshmdserviceserviceframeworksnativeserviceshmdserviceservicecommonihmdservercpp-needed-by-outtargetproductgeneric_arm64objshared_librarieslibhmdservice_intermediatesframeworksnativeserviceshmdserviceservicecommonihmdservero-missing-and-no-known-rule-to-make-it" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/hmdservice-1643317742418-27354174370a423f3b5f3f487370d9051454bf4003bbae27de8eaefda8520e7e.png" alt="picture 146" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/markshawn2020/keeps-learning/edit/master/docs/AndroidFramework/TaskB1-hmdservice-compile/how-to-compile-arpara-hmdservice-on-AOSP10.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2022-07-25T17:42:56.000Z">2022年7月25日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/keeps-learning/docs/AndroidFramework/TaskA7-aosp-coding/aosp-coding-howto"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">aosp coding howto</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/keeps-learning/docs/AndroidFramework/TaskB2-hmdservice-integration/native-service-integration-howto"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">native service integration howto</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#环境要求" class="table-of-contents__link toc-highlight">环境要求</a></li><li><a href="#全局变量本地示例" class="table-of-contents__link toc-highlight">全局变量（本地示例）</a></li><li><a href="#编译总览" class="table-of-contents__link toc-highlight">编译总览</a></li><li><a href="#step-1-初始化项目" class="table-of-contents__link toc-highlight">step 1. 初始化项目</a><ul><li><a href="#fix-1-glm-路径修正" class="table-of-contents__link toc-highlight">fix 1. <code>glm</code> 路径修正</a></li><li><a href="#项目拷贝" class="table-of-contents__link toc-highlight">项目拷贝</a></li><li><a href="#androidmk-配置" class="table-of-contents__link toc-highlight"><code>Android.mk</code> 配置</a></li></ul></li><li><a href="#step-2-usb-接口修复" class="table-of-contents__link toc-highlight">step 2. usb 接口修复</a><ul><li><a href="#修复需要新增timeout的三个接口manufacture--product--serial单位是毫秒目前改成了5000" class="table-of-contents__link toc-highlight">修复需要新增<code>timeout</code>的三个接口<code>manufacture | product | serial</code>，单位是毫秒，目前改成了5000</a></li><li><a href="#删除name没有用到接口也变了的一句代码" class="table-of-contents__link toc-highlight">删除<code>*name</code>没有用到，接口也变了的一句代码</a></li></ul></li><li><a href="#step-3-代码语法修复" class="table-of-contents__link toc-highlight">step 3. 代码语法修复</a><ul><li><a href="#-fall-through" class="table-of-contents__link toc-highlight">✅ <code>fall through</code></a></li><li><a href="#-删除空指针问题转为赋值为空指针" class="table-of-contents__link toc-highlight">✅ 删除空指针问题，转为赋值为空指针</a></li><li><a href="#-其他一些类型转换" class="table-of-contents__link toc-highlight">✅ 其他一些类型转换</a></li></ul></li><li><a href="#编译成功效果" class="table-of-contents__link toc-highlight">编译成功效果</a><ul><li><a href="#-build-success-of-libhmdservice" class="table-of-contents__link toc-highlight">✨ build success of <code>libhmdservice</code></a></li><li><a href="#-build-success-of-hmdservice" class="table-of-contents__link toc-highlight">✨✨ build success of <code>hmdservice</code></a></li></ul></li><li><a href="#引申阅读其他分析" class="table-of-contents__link toc-highlight">引申阅读/其他分析</a><ul><li><a href="#translate-androidmk" class="table-of-contents__link toc-highlight">translate <code>Android.mk</code></a></li><li><a href="#-androidbp-path-is-outside-directory" class="table-of-contents__link toc-highlight">✅ <code>Android.bp: Path is outside directory</code></a></li><li><a href="#-error-frameworksnativeserviceshmdserviceservice-moduletargetshared_librarieslibhmdservice-already-defined-by-frameworksnativeserviceshmdserviceservice" class="table-of-contents__link toc-highlight">✅ <code>error: frameworks/native/services/hmdservice/service: MODULE.TARGET.SHARED_LIBRARIES.libhmdservice already defined by frameworks/native/services/hmdservice/service.</code></a></li><li><a href="#-fatal-error-usbhostusbhosth-file-not-found" class="table-of-contents__link toc-highlight">✅ <code>fatal error: &#39;usbhost/usbhost.h&#39; file not found</code></a></li><li><a href="#usb-cover-progress" class="table-of-contents__link toc-highlight">usb cover progress</a></li><li><a href="#-error-unknown-type-name-usb_device-did-you-mean-usbdevice" class="table-of-contents__link toc-highlight">✅ <code>error: unknown type name &#39;usb_device&#39;; did you mean &#39;UsbDevice&#39;?</code></a></li><li><a href="#-变量没有使用的情况与手动修复过程放弃后来直接配mk了" class="table-of-contents__link toc-highlight">✅ 变量没有使用的情况与手动修复过程（放弃，后来直接配mk了）</a></li><li><a href="#-failed-ninja-frameworksnativeserviceshmdserviceserviceframeworksnativeserviceshmdserviceservicecommonihmdservercpp-needed-by-outtargetproductgeneric_arm64objshared_librarieslibhmdservice_intermediatesframeworksnativeserviceshmdserviceservicecommonihmdservero-missing-and-no-known-rule-to-make-it" class="table-of-contents__link toc-highlight">✅ <code>FAILED: ninja: &#39;frameworks/native/services/hmdservice/service/frameworks/native/services/hmdservice/service/common/IHmdServer.cpp&#39;, needed by &#39;out/target/product/generic_arm64/obj/SHARED_LIBRARIES/libhmdservice_intermediates/frameworks/native/services/hmdservice/service/common/IHmdServer.o&#39;, missing and no known rule to make it</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/keeps-learning/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/keeps-learning/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/keeps-learning/assets/js/runtime~main.2c4d9993.js"></script>
<script src="/keeps-learning/assets/js/main.2e9b1d76.js"></script>
</body>
</html>